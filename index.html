<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>SAL DEL SERI | Repartidor</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family: Arial, sans-serif;
  background:#f4f4f4;
  margin:0;
  padding:15px;
}
header{
  text-align:center;
  margin-bottom:20px;
}
header img{
  max-width:180px;
}
h2{color:#ff7a00}

.pedido{
  background:#fff;
  padding:15px;
  margin-bottom:15px;
  border-radius:8px;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
}
.pedido p{
  margin:5px 0;
  font-size:14px;
}

.botones{
  display:flex;
  gap:10px;
  margin-top:10px;
  flex-wrap:wrap;
}

.boton{
  flex:1;
  padding:10px;
  text-align:center;
  color:#fff;
  border-radius:5px;
  font-size:14px;
  text-decoration:none;
}

.maps{background:#34A853;}     /* Google Maps */
.waze{background:#1E88E5;}     /* Waze */
.entregar{background:#4CAF50; cursor:pointer; border:none;}
</style>
</head>

<body>

<header>
  <img src="yiyi.png" alt="SAL DEL SERI">
  <h2>üì¶ Pedidos Pendientes</h2>
</header>

<div id="lista"></div>

<!-- üî• FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, onSnapshot, doc, updateDoc } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDMBBaEgAk1EuRj7QSMqVsxnlC7aUvMz5w",
  authDomain: "sal-del-seri.firebaseapp.com",
  projectId: "sal-del-seri",
  storageBucket: "sal-del-seri.firebasestorage.app",
  messagingSenderId: "465867166498",
  appId: "1:465867166498:web:683a92396f3e369df4cb7b"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const lista = document.getElementById("lista");

async function entregarPedido(id, pedido){
  if(!confirm("¬øConfirmas que el pedido fue entregado?")) return;

  await updateDoc(doc(db,"pedidos",id),{
    estado:"entregado",
    entregadoEn: new Date()
  });

  const mensaje =
`üßÇ *SAL DEL SERI*
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚úÖ *PEDIDO ENTREGADO*
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üè™ ${pedido.negocio}
üìç ${pedido.direccion}
üßÇ Sacos: ${pedido.sacos}
üí∞ Total: $${pedido.total} MXN

Gracias por su compra ü§ù`;

  const tel = pedido.telefono.replace(/\D/g,"");
  window.open(`https://wa.me/52${tel}?text=${encodeURIComponent(mensaje)}`,"_blank");
}

// üîÑ TIEMPO REAL
onSnapshot(collection(db,"pedidos"), snap=>{
  lista.innerHTML = "";

  snap.forEach(docu=>{
    const p = docu.data();
    if(p.estado !== "pendiente") return;

    const direccion = encodeURIComponent(p.direccion);

    const div = document.createElement("div");
    div.className = "pedido";

    div.innerHTML = `
      <p><b>Negocio:</b> ${p.negocio}</p>
      <p><b>Responsable:</b> ${p.responsable}</p>
      <p><b>Tel:</b> ${p.telefono}</p>
      <p><b>Direcci√≥n:</b> ${p.direccion}</p>
      <p><b>Sacos:</b> ${p.sacos}</p>
      <p><b>Total:</b> $${p.total} MXN</p>

      <div class="botones">
        <a class="boton maps"
           href="https://www.google.com/maps/search/?api=1&query=${direccion}"
           target="_blank">
           üìç Google Maps
        </a>

        <a class="boton waze"
           href="https://waze.com/ul?q=${direccion}"
           target="_blank">
           üöó Waze
        </a>

        <button class="boton entregar">‚úÖ Entregado</button>
      </div>
    `;

    div.querySelector(".entregar")
      .onclick = ()=>entregarPedido(docu.id,p);

    lista.appendChild(div);
  });

  if(lista.innerHTML===""){
    lista.innerHTML="<p>No hay pedidos pendientes</p>";
  }
});
</script>

</body>
</html>
